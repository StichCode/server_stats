stages:
  - deploy
  - test


deploy:
  stage: deploy
  before_script:
    - sudo systemctl stop home_bot.service
  script:
    - rsync -a --info=progress2 --delete . $LOCAL_DIR/app
    - rm -rf $LOCAL_DIR/venv
    - python3.8 -m venv $LOCAL_DIR/venv && source $LOCAL_DIR/venv/bin/activate && pip install -r $LOCAL_DIR/app/requirments.txt
  after_script:
    - sudo systemctl start tg_bot.service
  tags:
    - home-bot

test:
  stage: test
  script:
    - systemctl status home_bot.service
  tags:
    - home-bot